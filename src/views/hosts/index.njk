{% extends "layout.njk" %}

{% set title = "Histórico de conectividade dos hosts" %}

{% block content %}
	<h1 class="my-5 text-center">{{ title }}</h1>
	<div class="form-group">
		<label for="sel1">Select list:</label>
		<select class="form-control" id="sel1">
			<option>1</option>
			<option>2</option>
			<option>3</option>
			<option>4</option>
		</select>
	</div>

	<section class="card-deck">
		{% for host in hosts %}
			<div class="card">
				<div class="card-header text-center font-weight-bold">
					<span>Nome:{{ host.name }}</span>
				</div>
				{% if file.isDirectory %}
					<div class="card-body p-0">
						<i class="fas fa-h3    "></i>
						<img src="/imgs/folder.png" alt="{{ file.name }}" class="w-100">
					</div>
				{% elif file.isImage %}
					<div class="card-body p-0">
						<i class="fas fa-h3    "></i>
						<img src="/datafiles/{{ file.name }}" alt="{{ file.name }}" class="w-100">
					</div>
				{% elif file.isText %}
					<div class="card-body p-0">
						<div class="roger-fullparent">
							<textarea class="roger-textarea"
								id="resultGetFileContent"							
								placeholder="Em breve o arquivo....">
								/datafiles/{{ file.name }}
							</textarea>
						</div>
					</div>
				{% else %}
					<div class="card-body p-0">
						<img src="/imgs/unknown.png" alt="{{ file.name }}" class="w-100">
						{# <img src="{{ file.image }}" alt="{{ file.name }}" class="w-100"> #}
					</div>
				{% endif %}
				<div class="card-footer text-right">
					{{ file.size }}
				</div>
			</div>
		{% endfor %}
	</section>
{% endblock %}

{% block script %}
	<script>
		//leitura dos tamanhos dos arquivos
		const sizes = document.querySelectorAll('.card-footer');
		sizes.forEach((size) => {
			size.innerHTML = "Tamanho = " + size.innerHTML;
		});

		//leotura dos conteúdos de texto
		const fileContents = document.querySelectorAll('.roger-textarea');
		fileContents.forEach((fileURL) => {
			url = fileURL.ownerDocument.location.origin + fileURL
				.value
				.trim();
			var xmlhttp,
				text;
			xmlhttp = new XMLHttpRequest();
			xmlhttp.open('GET', url, false);
			xmlhttp.send();
			text = xmlhttp.responseText;
			//text = 'Conteúdo remoto capturado com sucesso!!!' + url;
			//fileURL.innerHTML = text + fileURL.innerHTML;
			fileURL.value = text;
		});
	</script>
{% endblock %}